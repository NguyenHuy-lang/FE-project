<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Admin</title>
    <link rel="stylesheet" href="../../assets/vendors/mdi/css/materialdesignicons.min.css" />
    <link rel="stylesheet" href="../../assets/vendors/flag-icon-css/css/flag-icon.min.css" />
    <link rel="stylesheet" href="../../assets/vendors/css/vendor.bundle.base.css" />
    <link rel="stylesheet" href="../../assets/vendors/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../../assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css" />
    <link rel="stylesheet" href="../../assets/css/style.css" />
    <link rel="shortcut icon" href="../../assets/images/favicon.png" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js" type="text/javascript"></script>


</head>

<body>
    <div class="container-scroller">
        <nav class="sidebar sidebar-offcanvas" id="sidebar">
            <div class="text-center sidebar-brand-wrapper d-flex align-items-center">
                <!-- <a class="sidebar-brand brand-logo" href="../../index.html"><img src="../../assets/images/logo.svg"
                        alt="logo" /></a>
                <a class="sidebar-brand brand-logo-mini pl-4 pt-3" href="index.html"><img
                        src="../../assets/images/logo-mini.svg" alt="logo" /></a> -->
            </div>
            <ul class="nav">
                <li class="nav-item nav-profile">
                    <a href="#" class="nav-link">
                        <div class="nav-profile-image">
                            <img src="../../assets/images/faces/face1.jpg" alt="profile" />
                            <span class="login-status online"></span>
                            <!--change to offline or busy as needed-->
                        </div>
                        <div class="nav-profile-text d-flex flex-column pr-3">
                            <span class="font-weight-medium mb-2">Nguyễn Ngọc Đức Anh</span>
                            <span class="font-weight-normal">Hello admin</span>
                        </div>
                        <span class="badge badge-danger text-white ml-3 rounded">3</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../index.html">
                        <i class="mdi mdi-home menu-icon"></i>
                        <span class="menu-title">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="collapse" href="#ui-basic" aria-expanded="false"
                        aria-controls="ui-basic">
                        <i class="mdi mdi-crosshairs-gps menu-icon"></i>
                        <span class="menu-title">Product admin</span>
                        <i class="menu-arrow"></i>
                    </a>
                    <div class="collapse" id="ui-basic">
                        <ul class="nav flex-column sub-menu">
                            <li class="nav-item">
                                <a class="nav-link" href="../../pages/product_admin/product_list.html">List product</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../../pages/product_admin/product_add.html">Add product</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../pages/user_admin/user_admin.html">
                        <i class="mdi mdi-contacts menu-icon"></i>
                        <span class="menu-title">User admin</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../pages/category_admin/category_admin.html">
                        <i class="mdi mdi-format-list-bulleted menu-icon"></i>
                        <span class="menu-title">Category admin</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../pages/order_admin/order_admin.html">
                        <i class="mdi mdi-table-large menu-icon"></i>
                        <span class="menu-title">Order admin</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../pages/payment_admin/payment_admin.html">
                        <i class="mdi mdi-bank-transfer-in menu-icon"></i>
                        <span class="menu-title">Payment admin </span>
                    </a>
                </li>
                <li class="nav-item sidebar-actions">
                    <div class="nav-link">
                        <div class="mt-4">
                            <ul class="mt-4 pl-0">
                                <li>Sign Out</li>
                            </ul>
                        </div>
                    </div>
                </li>
            </ul>
        </nav>
        <div class="container-fluid page-body-wrapper">
            <div id="theme-settings" class="settings-panel">
                <i class="settings-close mdi mdi-close"></i>
                <p class="settings-heading">SIDEBAR SKINS</p>
                <div class="sidebar-bg-options selected" id="sidebar-default-theme">
                    <div class="img-ss rounded-circle bg-light border mr-3"></div> Default
                </div>
                <div class="sidebar-bg-options" id="sidebar-dark-theme">
                    <div class="img-ss rounded-circle bg-dark border mr-3"></div> Dark
                </div>
                <p class="settings-heading mt-2">HEADER SKINS</p>
                <div class="color-tiles mx-0 px-4">
                    <div class="tiles light"></div>
                    <div class="tiles dark"></div>
                </div>
            </div>
            <nav class="navbar col-lg-12 col-12 p-lg-0 fixed-top d-flex flex-row">
                <div class="navbar-menu-wrapper d-flex align-items-stretch justify-content-between">
                    <a class="navbar-brand brand-logo-mini align-self-center d-lg-none" href="../../index.html"><img
                            src="../../assets/images/logo-mini.svg" alt="logo" /></a>
                    <button class="navbar-toggler navbar-toggler align-self-center mr-2" type="button"
                        data-toggle="minimize">
                        <i class="mdi mdi-menu"></i>
                    </button>
                    <ul class="navbar-nav navbar-nav-right ml-lg-auto">
                        <li class="nav-item nav-profile dropdown border-0">
                            <a class="nav-link dropdown-toggle" id="profileDropdown" href="#" data-toggle="dropdown">
                                <img class="nav-profile-img mr-2" alt="" src="../../assets/images/faces/face1.jpg" />
                                <span class="profile-name">Admin</span>
                            </a>
                            <div class="dropdown-menu navbar-dropdown w-100" aria-labelledby="profileDropdown">
                                <a class="dropdown-item" href="#">
                                    <i class="mdi mdi-cached mr-2 text-success"></i> Activity Log </a>
                                <a class="dropdown-item" href="#">
                                    <i class="mdi mdi-logout mr-2 text-primary"></i> Signout </a>
                            </div>
                        </li>
                    </ul>
                    <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
                        data-toggle="offcanvas">
                        <span class="mdi mdi-menu"></span>
                    </button>
                </div>
            </nav>
            <div class="main-panel">
                <!-- put user here -->
                <div class="col-lg-9 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">List of user</h4>

                            <div class="table-responsive">
                                <table class="table" id="list_member">
                                    <thead>
                                        <tr>
                                            <th>STT</th>
                                            <th>Gmail</th>
                                            <th>Password</th>
                                            <th>User-type</th>
                                            <th>Username</th>
                                            <th>Address</th>
                                            <th>Phone</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <a href="/html/user/user_infor.html">Add new user</a>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- main-panel ends -->
        </div>
        <!-- page-body-wrapper ends -->
    </div>



    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="../../assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="../../assets/vendors/chart.js/Chart.min.js"></script>
    <script src="../../assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <script src="../../assets/vendors/flot/jquery.flot.js"></script>
    <script src="../../assets/vendors/flot/jquery.flot.resize.js"></script>
    <script src="../../assets/vendors/flot/jquery.flot.categories.js"></script>
    <script src="../../assets/vendors/flot/jquery.flot.fillbetween.js"></script>
    <script src="../../assets/vendors/flot/jquery.flot.stack.js"></script>
    <script src="../../assets/vendors/flot/jquery.flot.pie.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="../../assets/js/off-canvas.js"></script>
    <script src="../../assets/js/hoverable-collapse.js"></script>
    <script src="../../assets/js/misc.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="../../assets/js/dashboard.js"></script>
    <!-- End custom js for this page -->

    </script>
    <script>
        let apiData = [];
        const table = document.querySelector("#list_member");
        var Respone = localStorage.getItem("respone");
        console.log(Respone);

        fetch("http://127.0.0.1:8080/api/v1/admin/users")
            .then((response) => response.json())
            .then((data) => {
                apiData = data;
                data.forEach((row) => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
            <tr align="center" valign="center" id="item" >
                <td height="30px" id="Id" class = "item id">${row.id}</td>
                <td class = "item" id="gmail">${row.email}</td>
                <td class = "item" id="password">${row.password}</td>
                <td class = "item" id="user_type">${row.user_type}</td>
                <td class = "item" id="username">${row.username}</td>
                <td class = "item" id="address">${row.address}</td>
                <td class = "item" id="phone">${row.phone}</td>
                <td>
                  <button class="bt" id="btxoa" onclick="deleteItem(${row.id})">
                    <a href="/user/user.html"  class="Update">Xóa</a>
                    </button>
                  <button id="btEdit" class="bt btEdit"  >
                    <a  class="Update" href="/html/user/user_infor.html" >Chỉnh sửa</a>
                  </button>
                </td>
              </tr>
          `;
                    table.querySelector("tbody").appendChild(tr);
                });

                var myButton = document.querySelectorAll("#btEdit");
                var myID = "";
                localStorage.setItem("userId", myID);

                if (myButton.length !== 0) {
                    myButton.forEach(function (button, Index) {
                        button.addEventListener("click", function () {
                            myID = apiData[Index].id;
                            localStorage.setItem("userId", myID);
                            // deleteItem(myID);
                        });
                    });
                }
            });
        if (Respone != "") {
            fetch(`http://127.0.0.1:8080/api/v1/admin/users/${Respone}`)
                .then((response) => response.json())
                .then((data) => {
                    console.log(data);
                    var index;
                    const arr = data;

                    localStorage.setItem("respone", "");

                    const tbody = table.getElementsByTagName("tbody")[0];
                    const rows = tbody.getElementsByTagName("tr");

                    for (let i = 0; i < rows.length; i++) {
                        const cells = rows[i].getElementsByTagName("td");
                        if (cells[0].innerHTML == Respone) {
                            index = i;
                            console.log(index);
                            break;
                        }
                    }
                    console.log(arr.email);
                    rows[index].cells[1].innerText = arr.email;
                    rows[index].cells[2].innerText = arr.password;
                    rows[index].cells[3].innerText = arr.user_type;
                    rows[index].cells[4].innerText = arr.username;
                    rows[index].cells[5].innerText = arr.address;
                    rows[index].cells[6].innerText = arr.phone;
                });
        }

        function deleteItem(itemId) {
            fetch(`http://127.0.0.1:8080/api/v1/admin/users/${itemId}`, {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json",
                },
            }).then((response) => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                const itemElement = document.querySelector(
                    `li[data-item-id="${itemId}"]`
                );
                itemElement.remove();
            });
        }
    </script>
</body>

</html>