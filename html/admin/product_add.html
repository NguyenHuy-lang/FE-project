<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"></script>
    <meta charset="UTF-8"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link href="/css/product_add.css" rel="stylesheet"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#btnadd").click(function (event) {
                const imgTag = document.querySelector('img'); //get the img tag element
                const srcValue = imgTag.getAttribute('src');
                var wsUrl = "http://127.0.0.1:8080/api/v1/admin/products";
                var restrequest = '{"id": null' + ','
                    + '"name":' + '"' +$("#prdname").val() + '"' + ','
                    + '"description":'+ '"' +$("#description").val() + '"' + ','
                    + '"imgPath":'+ '"' + srcValue + '"' + ','
                    + '"price":'+ $("#price").val() + ','
                    + '"cate": {"id":'+ $("#category-select").val() +'}' + ','
                    + '"listComment": []' + ','
                    + '"rating": null}';
                alert(restrequest);
                $.ajax({
                    type: "POST",
                    url: wsUrl,
                    contentType: "application/json",
                    dataType: "json",
                    data: restrequest,
                    success: processSuccess,
                    error: processError
                });

            });
        });

        function processSuccess(data, status, req) {
            alert('success');
            // const xmlResponse = req.responseXML;
            // console.log(xmlResponse);
            // const statusElement = xmlResponse.getElementsByTagName('ns2:getOrderResponse')[0];
            // const statusValue = statusElement.textContent;
            // console.log(statusValue);
            // alert(statusValue);
        }

        function processError(data, status, req) {
            alert('error ' + data.state);
            //alert(req.responseText + " " + status);
        }
    </script>
    
</head>
<body>
    <script type="text/javascript">
        fetch('http://localhost:8080/api/v1/categories')
        .then(response => response.json())
        .then(data => {
            // handle the data
            const selectElement = document.querySelector('#category-select');
            data.forEach(category => {
                const optionElement = document.createElement('option');
                optionElement.value = category.id;
                optionElement.textContent = category.name;
                selectElement.appendChild(optionElement);
            });
        });

    </script>
    <div class="Home">
        <div class="Main">
            <div class="Main-title">
                <div class="Title">THÔNG TIN SẢN PHẨM</div>
            </div>
            <div class="Main-infor">
                <div class="Infor">
                    <input class="Infor_text" id="prdname" placeholder="Tên mặt hàng" type="text" required/>
                </div>
                <div class="null"></div>
                <div class="Infor">
                    <input class="Infor_text" id="description" placeholder="Mô tả" type="text" required/>
                </div>
                <div class="null"></div>
                
                <input type="file" class="inputFile" id="fileinp"onchange="getFile(event)"
                accept="image/*"/>
                <label for="fileinp">+</label>
                <span class="fileText"></span>
                <button onclick="uploadImage()" id="upbtn">Upload image</button>
                <div class="bar">
                    <div class="process"></div>
                </div>
                <div class="uploadPercentage">0%</div>
                <div class="imageUploaded">
                    <img width="100dp" height="100dp" alt="" class="img">
                </div>
                <div class="null"></div>
                <div class="Infor">
                    <input class="Infor_text" id="price" placeholder="Giá" type="text" required/>
                </div>
                <div class="null"></div>
                <div>
                    <label for="category-select">Select a category:</label>
                    <select id="category-select"></select>
                </div>
                <div class="null"></div>
            </div>
            <div class="Button_save">
                <button class="Save" id="btnadd">
                    <a class="save" href="/html/admin/product_list.html">SAVE</a>
                </button>
            </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase.js"></script>
    <script src="/js/fileservice.js"></script>
</body>
</html>
