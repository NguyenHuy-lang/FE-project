<!DOCTYPE html>
<html lang="en">

  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"></script>
    <meta charset="UTF-8"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link href="/css/product_list.css" rel="stylesheet"/>
    <link href="/css/product_add.css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>

  <body>
    <div class="search-box">
      <h1 >Search product</h1>
      <p>Enter syntax:</p>
      <input type="text" id="search-box"><br>
      <select style="max-width:90%;" id="search-results" size="5"></select>
    </div>
    
    <script>
      $(document).ready(function() {
        $('#search-box').on('keyup', function() {
          var query = $(this).val();
          var url = 'http://127.0.0.1:8080/api/v1/products/search/' + query;
          $.get(url, function(data) {
            var results = $('#search-results');
            results.empty();
            $.each(data, function() {
              results.append($('<option>').text(this.name).val(this.id));
            });
          });
        });
        $('#search-results').on('click', 'option', function() {
          var resultId = $(this).val();
          var url = 'http://127.0.0.1:8080/api/v1/admin/products/' + resultId;
          alert(data);
          $.get(url, function(data) {
            $('#prdid').val(data.id);
            $('#prdname').val(data.name);
            $('#description').val(data.description);
            $('img').attr('src').val(data.imgPath);
            $('#price').val(data.price);
            $('#category-select').val(data.cate.name);
          });
        });
      });
      

    </script>
    <script>
      function deleteItem(itemId) {
        fetch(`http://localhost:8080/api/v1/admin/products/${itemId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
            // add any other necessary headers, such as authentication tokens
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          // handle successful response, such as removing the item from the UI
          const itemElement = document.querySelector(`li[data-item-id="${itemId}"]`);
          itemElement.remove();
        })
        .catch(error => {
          console.error('Error:', error);
          // handle error scenario, such as displaying an error message
        });
      }
    </script> 
    <br>
    <script>
      fetch("http://127.0.0.1:8080/api/v1/admin/products").then(
        res => {
          res.json().then(
            data => {
              console.log(data);
              if (data.length > 0) {
                var temp = "";
                data.forEach((itemData) => {
                  temp += `<tr>
                    <td>${itemData.id}</td>
                    <td><img src="${itemData.imgPath}" alt="Image placeholder" width="100dp" height="100dp" class="img-fluid"></td>
                    <td>${itemData.name}</td>
                    <td>${itemData.price}</td>
                    <td>${itemData.cate.name}</td>
                    <td>
                      <div class="Button">
                        <button onclick="deleteItem(${itemData.id})" id="Bt" type="button">
                          <a href="/html/admin/product_list.html" class="Bt_text">Delete</a>
                        </button>
                        <button onclick="populateFormWithApiData(${itemData.id})" id="Bt" class="detailbtn" type="button">
                          <a class="Bt_text">Update</a>
                        </button>
                      </div>
                    </td>
                  </tr>`;

                });
                document.getElementById('data').innerHTML = temp;
              }
            }
          )
        }
      )
      
      // const imgTag = document.querySelector("img"); //get the img tag element
      // const srcValue = imgTag.getAttribute('src');
      
    </script>
    <script>
      function populateFormWithApiData(id) {
        // Replace URL with your API endpoint and ID parameter name
        fetch(`ttp://127.0.0.1:8080/api/v1/admin/products/${id}`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          if (response.ok) {
            return response.json();
          } else {
            console.error('Failed to retrieve data.');
            // Handle the error or display a message to the user
          }
        })
        .then(data => {
          // Replace "formField" with your form field IDs or names
          document.getElementById('prdid').value = data.id;
          document.getElementById('prdname').value = data.name;
          document.getElementById('description').value = data.description;
          const imagePath = data.path;
          const imgElement = document.querySelector("img");
          imgElement.setAttribute("src", imagePath);
          document.getElementById('price').value = data.price;
          document.getElementById('category-select').getElementsByTagName('option') = data.cate.name;
          // ... and so on for each field
        })
        .catch(error => {
          console.error('Error occurred while retrieving data:', error);
          // Handle the error or display a message to the user
        });
      }
    </script>
    <script type="text/javascript">
      fetch('http://localhost:8080/api/v1/categories')
      .then(response => response.json())
      .then(data => {
          // handle the data
          const selectElement = document.querySelector('#category-select');
          data.forEach(category => {
              const optionElement = document.createElement('option');
              optionElement.value = category.id;
              optionElement.textContent = category.name;
              selectElement.appendChild(optionElement);
          });
      });
    </script>
    <div class="container">
      <button><a href="/html/admin/product_add.html">Add product</a></button>
      <table  class="table table-striped table-responsive-md" border="1" id="myTable" >
        <thead>
          <tr>
            <th>ID</th>
            <th>Image</th>
            <th>Product name</th>
            <th>Price</th>
            <th>Category</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="data">
          <!-- rows will be dynamically inserted here -->
        </tbody>
      </table>
    </div>
    <form width="100" id="update-form">
      <div>
        <input id="prdid" type="hidden"/>
      </div>
      <div class="null"></div>
      <div >
        <label>Tên mặt hàng </label>
        <input class="form-control mb-4 col-4" id="prdname" placeholder="Tên mặt hàng" type="text" required/>
      </div>
      <div class="null"></div>
      <div >
        <label>Mô tả</label>
        <input class="form-control mb-4 col-4" id="description" placeholder="Mô tả" type="text" required/>
      </div>
      <div class="null"></div>
      <div>
        <input type="file" class="inputFile" id="fileinp"onchange="getFile(event)"
        accept="image/*"/>
        <label for="fileinp">+</label>
        <span class="fileText"></span>
        <button onclick="uploadImage()" id="upbtn">Upload image</button>
        <div class="bar">
            <div class="process"></div>
        </div>
        <div class="uploadPercentage">0%</div>
        <div class="imageUploaded">
            <img style="width: 20dp; height: 20dp;" width="20dp" height="20dp" alt="" class="img">
        </div>
      </div>
      
      <div class="null"></div>
      <div>
          <input class="form-control mb-4 col-4" id="price" placeholder="Giá" type="text" required/>
      </div>
      <div class="null"></div>
      <div>
          <label for="category-select">Select a category:</label>
          <select id="category-select"></select>
      </div>
      <div class="null"></div>
      <button id="update-btn" type="submit">Submit</button>
    </form>
    
    
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase.js"></script>
    <script src="/js/fileservice.js"></script>
    <script href="/js/product.js"></script>
  </body>

</html>